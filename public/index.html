<html>
  <head>
    <title>CDP &lt;-&gt; OpenMRS connector</title>
    <script type="text/javascript">
      var patientsUuids = [];
      function searchPatient() {
        var patientName = document.getElementById("patientName").value

        var httpRequest;
        if (window.XMLHttpRequest) {
            httpRequest = new XMLHttpRequest();
        } else if (window.ActiveXObject) {
            httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
        }
        httpRequest.onreadystatechange = function() {
          if (httpRequest.readyState === 4) {
            if (httpRequest.status === 200) {
              console.log(httpRequest.responseText);
              showPatients(JSON.parse(httpRequest.responseText));
            } else {
              console.log('There was a problem with the request.');
            }
          }
        }

        httpRequest.open('GET', 'http://localhost:4567/patient?name=' + patientName, true);
        httpRequest.send(null);

      }

      function selectPatient(event) {
        var selection = event.target;
        
        document.getElementById("selectedPatientName").textContent = selection.textContent;
        document.getElementById("selectedPatientUuid").value = patientsUuids[selection.value]
      }

      function submitSample() {

      }

      function showPatients(response) {
        var patientsList = document.getElementById('patientsList');
        while(patientsList.firstChild) {
          patientsList.removeChild(patientsList.firstChild);
        }
        patientsUuids = [];

        for(index in response.results) {
          var result = response.results[index];
          var li = document.createElement('li');
          li.onclick = selectPatient;
          li.textContent = result.display;
          li.value = index;
          patientsUuids[index] = result.uuid;
          patientsList.appendChild(li);
        }
      }
    </script>
  </head>
  <body>
    Patient name: <input type="text" id="patientName" /> <input type="submit" onclick="javascript:searchPatient()" value="Search" />

    <ul id="patientsList">
    </ul>

    Patient: <span id="selectedPatientName"></span>
    <input type="hidden" id="selectedPatientUuid" /><br />
    Sample ID: <input type="text" id="sampleID" />
    <input type="submit" onclick="submitSample" value="Register sample" />
  </body>
</html>